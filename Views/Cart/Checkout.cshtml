@{
    ViewBag.Title = "Cart";
}

<div class="container pt-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Product Details</th>
                            <th scope="col">Quantity</th>
                            <th scope="col">Product Price</th>
                            <th scope="col">Total</th>
                        </tr>
                    </thead>
                    <tbody id="cart-items">
                        <!-- Cart items will be populated here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-md-5 justify-content-end mt-4">
            <div>
                <article class="card">
                    <h1 class="fs-5 text-center card-header">CART SUMMARY</h1>
                    <div class="card-body">
                        <p class="fs-6 text-center">Subtotal</p>
                        <p class="fs-6 text-center" id="cart-subtotal">@string.Format(System.Globalization.CultureInfo.GetCultureInfo("en-GB"), "{0:C}", 0)</p>
                    </div>
                    <div class="text-center">
                        <div>
                            <a href="/checkout" class="btn btn-warning  text-center m-3"><i class="fa fa-paypal" aria-hidden="true"></i>
                                <span class="text-blue">Pay</span><span class="">Pal</span> 
                            </a>
                        </div>
                        <div>
                            <a href="/checkout" class="btn btn-danger fs-6 text-center m-3">Pay later </a>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </div>
</div>

<script>
    window.addEventListener("load", (event) => {
        loadCart();
    })
        function loadCart() {
            $.ajax({
                url: '/Cart/GetCartItems',
                type: 'GET',
                success: function (response) {
                    if (response.success) {
                        renderCartItems(response.cartItems);
                        $('#cart-subtotal').text(response.cartTotal);
                    } else {
                        alert('Failed to load the cart.');
                    }
                },
                error: function () {
                    alert('An error occurred while loading the cart.');
                }
            });
        }
    document.addEventListener('click', function (event) {
        if (event.target.closest('.increment-quantity')) {
            var itemId = event.target.closest('tr').getAttribute('data-item-id');
            updateCartItem(itemId, true);
        }
    });

    // Event handler for decrement button
    document.addEventListener('click', function (event) {
        if (event.target.closest('.decrement-quantity')) {
            var itemId = event.target.closest('tr').getAttribute('data-item-id');
            updateCartItem(itemId, false);
        }
    });


        // Function to render cart items
        function renderCartItems(cartItems) {
            var tbody = $('#cart-items');
            tbody.empty();
            cartItems.forEach(function (item) {
                tbody.append(`
                        <tr data-item-id="${item.id}">
                            <td>${item.productName}</td>
                            <td>
                                <span class="d-flex">
                                    <button class="btn btn-sm mx-2 btn-outline-success decrement-quantity"><i class="fa fa-minus"></i></button>
                                    <span class="item-quantity">${item.quantity}</span>
                                    <button class="btn btn-sm mx-2 btn-outline-success increment-quantity"><i class="fa fa-plus"></i></button>
                                </span>
                            </td>
                            <td>${item.priceFormatted}</td>
                            <td class="item-total">${item.itemTotalFormatted}</td>
                        </tr>
                    `);
            });
        }

        // Function to update cart item via AJAX
        function updateCartItem(itemId, action) {
            $.ajax({
            url: '/Cart/AddReduceMore',
                type: 'POST',
            data: { productId: itemId, isActionAdd: action },
                success: function (response) {
                    if (response.success) {
                    loadCart();
                } else {
                        alert('Failed to update the cart.');
                    }
                },
                error: function () {
                    alert('An error occurred while updating the cart.');
                }
            });
        }

        // Event handler for increment button
      
       
  
</script>
